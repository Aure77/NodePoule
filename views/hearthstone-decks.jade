extends layout
    
block head
  link(rel='stylesheet', href='#{staticsPrefixPath}/stylesheets/decklist.css')
  link(rel='stylesheet', href='#{staticsPrefixPath}/stylesheets/selectize.css')
  script(type='text/javascript', src='#{staticsPrefixPath}/javascripts/selectize.min.js')
  script(type='text/javascript').
    $(function() {
        var posX=0,posY=0;
        $(document).on('mousemove', function(event) {
           posX = event.pageX-210;
           posY = event.pageY-150;
        });
    
        $(document).on('mouseenter', '.decklist-content li .card-name a',  function(e) {
          console.log("mouseenter");
          $(this).closest('li').find('.decklist-popup').show();
          $(this).closest('li').find('.decklist-popup').offset({top: posY, left: posX});
        }).on("mouseleave", '.decklist-content li .card-name a', function() {
          $(this).closest('li').find('.decklist-popup').offset({top: 0, left: 0});
          $(this).closest('li').find('.decklist-popup').hide();
        });
        
        
        $("#deck-search").selectize({
            create: false,
            persist: false,
            plugins: ['remove_button'],
            options: !{JSON.stringify(cards)},
            maxItems: 30,
            maxOptions: 20,
            valueField: 'id',
            searchField: ['name', 'type'],
            onItemAdd: function(value, $item) {
              var card = $item.data('card-item');
              var li = $('<li>', { id: card.id });
              var cardDiv = $('<div>',{ class: 'decklist-card ' + card.type.toLowerCase() });
              var popup = $('<div>', { class: 'decklist-popup' });
              $('<img/>', { src: '#{staticsPrefixPath}/img/decklist/cartes/' + card.id + '.png' }).appendTo(popup)
              $('<p>', { class: 'decklist-desc' }).html(card.flavor).appendTo(popup);
              popup.appendTo(cardDiv);
              $('<p>', { class: 'card-mana' }).html(card.cost).appendTo(cardDiv);
              var cardName = $('<p>', { class: 'card-name' });
              $('<a>').html(card.name).appendTo(cardName);
              cardName.appendTo(cardDiv);
              $('<p>', { class: 'card-health' }).html((typeof card.health === 'undefined')? card.durability : card.health).appendTo(cardDiv);
              $('<p>', { class: 'card-attack' }).html(card.attack).appendTo(cardDiv);
              var chkBox = $('<label />').html(' x2').prepend($('<input/>').attr({ type: 'checkbox', value: card.id}));
              chkBox.appendTo(cardDiv);
              cardDiv.appendTo(li);
              li.appendTo(".decklist-content ul");
            },
            onItemRemove: function(value) {
              $('li#' + value).remove();
            },
            render: {
                item: function(item, escape) {
                    return '<div data-card-item="' + escape(JSON.stringify(item)) + '">' + (item.name ? '<span class="name">' + escape(item.name) + '</span>' : '') + '</div>';
                },
                option: function(item, escape) {
                    return '<div><span style="display: block; background-image:url(\'#{staticsPrefixPath}/img/decklist/cartes/' + escape(item.id) + '.png\'); background-repeat:no-repeat; background-size: 200%; background-position: -25px -25px; height: 50px; width: 50px;"></span><span class="label" style="height: 50px;">' + escape(item.name) + '</span> <small>(' + escape(item.type) + ')</small></div>';
                }
            }
        });
    });
    
block content
  .main.zerogrid
    div
      select(id="deck-search",class="chosen-select", multiple, data-placeholder="Rechercher une carte...", style="width:380px;")
    
    div(class='decklist-top')
      img(src='#{staticsPrefixPath}/img/decklist/decklist_top.png')
    
    div(class='decklist-content')
      ul
    
    div(class='decklist-bottom')
      img(src='#{staticsPrefixPath}/img/decklist/decklist_bottom.jpg')
